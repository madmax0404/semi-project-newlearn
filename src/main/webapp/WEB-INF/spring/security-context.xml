<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
	xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd">
	<!-- 암호화 인코딩 기능을 가진 bean 객체 등록 -->
	<beans:bean id="bcryptPasswordEncoder"
		class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />

	<http security="none" pattern="/resources/**" />
	<http auto-config="true">
		<!-- <csrf disabled="true" /> --> 
		<!-- <intercept-url pattern="/**" access="permitAll" /> -->
		<!-- 메인페이지(/), 회원가입 페이지(/security/insert), 로그인 페이지, 아이디 중복 체크는 모든 사용자가 
			이용 가능하도록 설정 -->
		<!-- 관리자와 관련된 URL은 관리자 권한을 가지고 있어야만 접근 가능하도록 제한 -->
		<!-- <intercept-url pattern="/user/**"
			access="hasRole('USER')" /> -->
		<!-- <intercept-url pattern="/**" access="hasAnyRole('USER', 'ADMIN')" 
			/> -->
			
		<intercept-url pattern="/member/**" access="permitAll" />
		<intercept-url pattern="/security/insert" access="permitAll" />
		<intercept-url pattern="/teacher/**" access="hasRole('TEACHER')" />
		<intercept-url pattern="/**" access="hasAnyRole('USER', 'ADMIN')" />

		<form-login login-page="/member/login"
			login-processing-url="/member/login" username-parameter="userId"
			password-parameter="userPwd"
			authentication-failure-url="/member/login?error"
			authentication-success-handler-ref="customLoginSuccessHandler" />
			<!-- default-target-url="/" /> -->

		<!-- servlet의 mapping url이 아닌 filter의 mapping url -->
		<logout logout-url="/member/logout" invalidate-session="true"
			logout-success-url="/" />

		 <remember-me data-source-ref="dataSource"
			token-validity-seconds="1209600"
			authentication-success-handler-ref="customLoginSuccessHandler"
			 />

		<!-- 권한 없는 페이지 접근시 처리할 핸들러 -->
		<access-denied-handler
			error-page="/security/accessDenied" />
	</http>


	<context:component-scan
		base-package="com.newlearn.playground">
		<context:exclude-filter type="annotation"
			expression="org.springframework.stereotype.Controller" />
	</context:component-scan>

	<beans:bean id="customLoginSuccessHandler" class="com.newlearn.playground.common.CustomLoginSuccessHandler" />

	<authentication-manager>
		<authentication-provider
			user-service-ref="securityServiceImpl">
			<password-encoder ref="bcryptPasswordEncoder" />
		</authentication-provider>
	</authentication-manager>
</beans:beans>









